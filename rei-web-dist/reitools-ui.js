/*! For license information please see reitools-ui.js.LICENSE.txt */
!function(n,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("React")):"function"==typeof define&&define.amd?define(["React"],e):"object"==typeof exports?exports.ReiToolsUI=e(require("React")):n.ReiToolsUI=e(n.React)}(this,n=>(()=>{"use strict";var e={20:(n,e,t)=>{var o=t(883),r=Symbol.for("react.element"),a=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),i=o.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function l(n,e,t){var o,l={},d=null,c=null;for(o in void 0!==t&&(d=""+t),void 0!==e.key&&(d=""+e.key),void 0!==e.ref&&(c=e.ref),e)a.call(e,o)&&!s.hasOwnProperty(o)&&(l[o]=e[o]);if(n&&n.defaultProps)for(o in e=n.defaultProps)void 0===l[o]&&(l[o]=e[o]);return{$$typeof:r,type:n,key:d,ref:c,props:l,_owner:i.current}}e.jsx=l,e.jsxs=l},56:(n,e,t)=>{n.exports=function(n){var e=t.nc;e&&n.setAttribute("nonce",e)}},72:n=>{var e=[];function t(n){for(var t=-1,o=0;o<e.length;o++)if(e[o].identifier===n){t=o;break}return t}function o(n,o){for(var a={},i=[],s=0;s<n.length;s++){var l=n[s],d=o.base?l[0]+o.base:l[0],c=a[d]||0,p="".concat(d," ").concat(c);a[d]=c+1;var u=t(p),f={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==u)e[u].references++,e[u].updater(f);else{var x=r(f,o);o.byIndex=s,e.splice(s,0,{identifier:p,updater:x,references:1})}i.push(p)}return i}function r(n,e){var t=e.domAPI(e);return t.update(n),function(e){if(e){if(e.css===n.css&&e.media===n.media&&e.sourceMap===n.sourceMap&&e.supports===n.supports&&e.layer===n.layer)return;t.update(n=e)}else t.remove()}}n.exports=function(n,r){var a=o(n=n||[],r=r||{});return function(n){n=n||[];for(var i=0;i<a.length;i++){var s=t(a[i]);e[s].references--}for(var l=o(n,r),d=0;d<a.length;d++){var c=t(a[d]);0===e[c].references&&(e[c].updater(),e.splice(c,1))}a=l}}},113:n=>{n.exports=function(n,e){if(e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}},157:n=>{n.exports="data:image/svg+xml,%3csvg xmlns=%27http://www.w3.org/2000/svg%27 fill=%27none%27 viewBox=%270 0 20 20%27%3e%3cpath stroke=%27%23cccccc%27 stroke-linecap=%27round%27 stroke-linejoin=%27round%27 stroke-width=%271.5%27 d=%27M6 8l4 4 4-4%27/%3e%3c/svg%3e"},267:(n,e,t)=>{t.d(e,{A:()=>h});var o=t(601),r=t.n(o),a=t(314),i=t.n(a),s=t(417),l=t.n(s),d=new URL(t(401),t.b),c=new URL(t(429),t.b),p=new URL(t(157),t.b),u=new URL(t(567),t.b),f=i()(r()),x=l()(d),m=l()(c),g=l()(p),b=l()(u);f.push([n.id,`.reitools-panel {\n  font-size: 13px;\n}\n\n.reitools-tabs {\n  display: flex;\n  border-bottom: 1px solid #404040;\n  margin-bottom: 16px;\n}\n\n.tab {\n  background: none;\n  border: none;\n  color: #999999;\n  padding: 8px 16px;\n  cursor: pointer;\n  font-size: 13px;\n  transition: all 0.2s;\n  border-bottom: 2px solid transparent;\n}\n\n.tab:hover {\n  color: #ffffff;\n  background: #333333;\n}\n\n.tab.active {\n  color: #ffffff;\n  border-bottom-color: #007acc;\n}\n\n.reitools-content {\n  height: calc(100% - 40px);\n  overflow-y: auto;\n}\n\n.tools-section h3,\n.config-section h3,\n.info-section h3 {\n  color: #ffffff;\n  font-size: 14px;\n  margin: 0 0 12px 0;\n  font-weight: 600;\n}\n\n.tool-group {\n  margin-bottom: 20px;\n}\n\n.tool-button {\n  display: block;\n  width: 100%;\n  background: #333333;\n  border: 1px solid #404040;\n  color: #ffffff;\n  padding: 10px 12px;\n  margin-bottom: 6px;\n  border-radius: 4px;\n  cursor: pointer;\n  font-size: 13px;\n  text-align: left;\n  transition: all 0.2s;\n}\n\n.tool-button:hover {\n  background: #404040;\n  border-color: #555555;\n}\n\n.tool-button:active {\n  background: #2a2a2a;\n}\n\n.config-group {\n  margin-bottom: 20px;\n}\n\n.config-item {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  margin-bottom: 10px;\n  color: #cccccc;\n  cursor: pointer;\n}\n\n.config-item input[type="checkbox"] {\n  margin-right: 8px;\n}\n\n.config-item input[type="range"] {\n  width: 100px;\n}\n\n.config-item select {\n  background: #333333;\n  border: 1px solid #404040;\n  color: #ffffff;\n  padding: 4px 8px;\n  border-radius: 4px;\n  font-size: 12px;\n}\n\n.info-section p {\n  color: #cccccc;\n  margin: 8px 0;\n  line-height: 1.4;\n}\n\n.info-section ul {\n  color: #cccccc;\n  padding-left: 20px;\n  margin: 12px 0;\n}\n\n.info-section li {\n  margin-bottom: 4px;\n}\n\n.links {\n  margin-top: 20px;\n  padding-top: 16px;\n  border-top: 1px solid #404040;\n}\n\n.links a {\n  color: #007acc;\n  text-decoration: none;\n  font-size: 13px;\n}\n\n.links a:hover {\n  text-decoration: underline;\n}\n\n/* 参数聚焦相关样式 */\n.param-focus-section {\n  padding: 0;\n}\n\n/* 按钮组样式 */\n.button-group {\n  display: flex;\n  gap: 8px;\n  margin: 12px 0;\n}\n\n/* 刷新按钮样式 */\n.refresh-button {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 6px;\n  width: auto;\n  max-width: 160px;\n  background: linear-gradient(135deg, #007acc 0%, #0099ff 100%);\n  border: none;\n  color: #ffffff;\n  padding: 8px 14px;\n  margin: 0;\n  border-radius: 4px;\n  flex: 1;\n  cursor: pointer;\n  font-size: 13px;\n  font-weight: 500;\n  font-family: inherit;\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  box-shadow: \n    0 1px 4px rgba(0, 122, 204, 0.3),\n    0 1px 2px rgba(0, 0, 0, 0.2);\n  position: relative;\n  overflow: hidden;\n}\n\n.refresh-button::before {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: -100%;\n  width: 100%;\n  height: 100%;\n  background: linear-gradient(90deg, \n    transparent, \n    rgba(255, 255, 255, 0.2), \n    transparent\n  );\n  transition: left 0.5s ease;\n}\n\n.refresh-button:hover {\n  background: linear-gradient(135deg, #0066aa 0%, #0088dd 100%);\n  transform: translateY(-2px);\n  box-shadow: \n    0 4px 16px rgba(0, 122, 204, 0.4),\n    0 2px 6px rgba(0, 0, 0, 0.3);\n}\n\n.refresh-button:hover::before {\n  left: 100%;\n}\n\n.refresh-button:active {\n  transform: translateY(0);\n  box-shadow: \n    0 2px 4px rgba(0, 122, 204, 0.3),\n    0 1px 2px rgba(0, 0, 0, 0.2);\n}\n\n.refresh-icon {\n  font-size: 14px;\n  display: inline-block;\n  transition: transform 0.3s ease;\n}\n\n.refresh-button:hover .refresh-icon {\n  transform: rotate(180deg);\n}\n\n.refresh-button:active .refresh-icon {\n  transform: rotate(360deg);\n}\n\n/* 运行按钮样式 */\n.run-button {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 6px;\n  width: auto;\n  max-width: 120px;\n  background: linear-gradient(135deg, #28a745 0%, #34ce57 100%);\n  border: none;\n  color: #ffffff;\n  padding: 8px 14px;\n  margin: 0;\n  border-radius: 4px;\n  flex: 1;\n  cursor: pointer;\n  font-size: 13px;\n  font-weight: 500;\n  font-family: inherit;\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  box-shadow: \n    0 1px 4px rgba(40, 167, 69, 0.3),\n    0 1px 2px rgba(0, 0, 0, 0.2);\n  position: relative;\n  overflow: hidden;\n}\n\n.run-button::before {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: -100%;\n  width: 100%;\n  height: 100%;\n  background: linear-gradient(90deg, \n    transparent, \n    rgba(255, 255, 255, 0.2), \n    transparent\n  );\n  transition: left 0.5s ease;\n}\n\n.run-button:hover {\n  background: linear-gradient(135deg, #218838 0%, #28a745 100%);\n  transform: translateY(-2px);\n  box-shadow: \n    0 4px 16px rgba(40, 167, 69, 0.4),\n    0 2px 6px rgba(0, 0, 0, 0.3);\n}\n\n.run-button:hover::before {\n  left: 100%;\n}\n\n.run-button:active {\n  transform: translateY(0);\n  box-shadow: \n    0 2px 4px rgba(40, 167, 69, 0.3),\n    0 1px 2px rgba(0, 0, 0, 0.2);\n}\n\n.run-icon {\n  font-size: 14px;\n  display: inline-block;\n  transition: transform 0.3s ease;\n}\n\n.run-button:hover .run-icon {\n  transform: scale(1.2);\n}\n\n.run-button:active .run-icon {\n  transform: scale(0.9);\n}\n\n.params-list {\n  margin-top: 16px;\n  display: grid;\n  grid-template-columns: 1fr;\n  gap: 10px;\n  transition: all 0.3s ease;\n}\n\n/* 移除容器查询，完全使用JavaScript控制 */\n\n/* JavaScript控制的宽布局样式 */\n.params-list.wide-layout {\n  grid-template-columns: 1fr 1fr;\n  gap: 12px;\n}\n\n/* 宽布局下的参数项调整 */\n.params-list.wide-layout .param-item {\n  padding: 10px;\n}\n\n.params-list.wide-layout .param-text-input,\n.params-list.wide-layout .param-number-input,\n.params-list.wide-layout .param-select {\n  font-size: 12px;\n  padding: 6px 10px;\n}\n\n.params-list.wide-layout .param-input {\n  font-size: 12px;\n  padding: 6px 10px;\n  rows: 2;\n}\n\n.param-item {\n  background: #333333;\n  border: 1px solid #404040;\n  border-radius: 6px;\n  padding: 12px;\n  margin-bottom: 0; /* 移除margin，使用grid gap */\n  transition: all 0.2s ease;\n  position: relative;\n  cursor: grab;\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n  user-select: none;\n  min-height: fit-content;\n}\n\n.param-item:active {\n  cursor: grabbing;\n}\n\n/* 移除pointer-events限制，通过JS逻辑控制拖拽 */\n\n.param-item:hover {\n  border-color: #555555;\n  background: #383838;\n}\n\n/* 拖拽状态样式 */\n.param-item.dragging {\n  opacity: 0.5;\n  transform: rotate(5deg);\n  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);\n  z-index: 1000;\n}\n\n.param-item.drag-over {\n  border-color: #007acc;\n  background: #404040;\n  transform: translateY(-2px);\n  box-shadow: 0 4px 15px rgba(0, 122, 204, 0.3);\n}\n\n/* 拖拽手柄样式 */\n.rei-drag-handle {\n  position: absolute;\n  top: 8px;\n  right: 8px;\n  color: #666666;\n  font-size: 16px;\n  line-height: 1;\n  cursor: grab;\n  padding: 4px;\n  border-radius: 3px;\n  transition: all 0.2s ease;\n  user-select: none;\n}\n\n.rei-drag-handle:hover {\n  color: #999999;\n  background: rgba(255, 255, 255, 0.1);\n}\n\n.param-item:active .rei-drag-handle {\n  cursor: grabbing;\n}\n\n/* 拖拽提示样式 */\n.params-list {\n  position: relative;\n}\n\n.param-item::before {\n  content: '';\n  position: absolute;\n  top: -2px;\n  left: 0;\n  right: 0;\n  height: 2px;\n  background: #007acc;\n  opacity: 0;\n  transition: opacity 0.2s ease;\n}\n\n.param-item.drag-over::before {\n  opacity: 1;\n}\n\n.param-input {\n  width: 100%;\n  background: #2a2a2a;\n  border: 1px solid #404040;\n  border-radius: 4px;\n  color: #ffffff;\n  padding: 8px 10px;\n  margin-top: 6px;\n  font-size: 12px;\n  font-weight: 400;\n  font-family: inherit;\n  transition: all 0.2s ease;\n  box-sizing: border-box;\n  resize: vertical;\n  min-height: 60px;\n  line-height: 1.4;\n}\n\n.param-input:focus {\n  outline: none;\n  background: #333333;\n  border-color: #007acc;\n}\n\n.param-input:hover {\n  border-color: #555555;\n}\n\n.param-input::placeholder {\n  color: #999999;\n  font-style: normal;\n}\n\n/* 单行文本输入框样式 */\n.param-text-input {\n  width: 100%;\n  background: #2a2a2a;\n  border: 1px solid #404040;\n  border-radius: 4px;\n  color: #ffffff;\n  padding: 8px 12px;\n  margin-top: 6px;\n  font-size: 13px;\n  font-weight: 400;\n  font-family: inherit;\n  transition: all 0.2s ease;\n  box-sizing: border-box;\n  height: 36px;\n}\n\n.param-text-input:focus {\n  outline: none;\n  background: #333333;\n  border-color: #007acc;\n}\n\n.param-text-input:hover {\n  border-color: #555555;\n}\n\n.param-text-input::placeholder {\n  color: #999999;\n  font-style: normal;\n}\n\n/* 数字输入框样式 */\n.param-number-input {\n  width: 100%;\n  background: #2a2a2a;\n  border: 1px solid #404040;\n  border-radius: 4px;\n  color: #ffffff;\n  padding: 8px 12px;\n  margin-top: 6px;\n  font-size: 13px;\n  font-weight: 400;\n  font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;\n  transition: all 0.2s ease;\n  box-sizing: border-box;\n  text-align: right;\n}\n\n.param-number-input:focus {\n  outline: none;\n  background: #333333;\n  border-color: #007acc;\n  box-shadow: 0 0 0 2px rgba(0, 122, 204, 0.2);\n}\n\n.param-number-input:hover {\n  border-color: #555555;\n}\n\n/* 隐藏数字输入框的默认箭头 */\n.param-number-input::-webkit-outer-spin-button,\n.param-number-input::-webkit-inner-spin-button {\n  -webkit-appearance: none;\n  margin: 0;\n}\n\n.param-number-input[type=number] {\n  -moz-appearance: textfield;\n}\n\n/* 数字输入框的聚焦状态特效 */\n.param-number-input:focus {\n  background: linear-gradient(135deg, #2a2a2a 0%, #333333 100%);\n  color: #00d4ff;\n  text-shadow: 0 0 8px rgba(0, 212, 255, 0.3);\n}\n\n/* 下拉选择框样式 */\n.param-select {\n  width: 100%;\n  background: #2a2a2a;\n  border: 1px solid #404040;\n  border-radius: 4px;\n  color: #ffffff;\n  padding: 8px 12px;\n  margin-top: 6px;\n  font-size: 13px;\n  font-weight: 400;\n  font-family: inherit;\n  transition: all 0.2s ease;\n  box-sizing: border-box;\n  cursor: pointer;\n  /* 简化的下拉箭头样式 */\n  background: #2a2a2a url(${x}) no-repeat;\n  background-position: right 8px center;\n  background-size: 16px;\n  padding-right: 32px;\n  -webkit-appearance: none;\n  -moz-appearance: none;\n  appearance: none;\n}\n\n.param-select:focus {\n  outline: none;\n  background: #333333 url(${m}) no-repeat;\n  background-position: right 8px center;\n  background-size: 16px;\n  border-color: #007acc;\n  box-shadow: 0 0 0 2px rgba(0, 122, 204, 0.2);\n}\n\n.param-select:hover {\n  border-color: #555555;\n  background: #2a2a2a url(${g}) no-repeat;\n  background-position: right 8px center;\n  background-size: 16px;\n}\n\n/* 下拉选项样式 */\n.param-select option {\n  background: #2a2a2a;\n  color: #ffffff;\n  padding: 8px 12px;\n  border: none;\n}\n\n.param-select option:hover,\n.param-select option:checked {\n  background: #007acc;\n  color: #ffffff;\n}\n\n/* 禁用状态 */\n.param-select:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n  background: #2a2a2a url(${b}) no-repeat;\n  background-position: right 8px center;\n  background-size: 16px;\n}\n\n/* 移除重复的CSS定义，使用上面的grid布局 */\n\n/* 文件选择器演示页面样式 */\n.file-selector-section {\n  padding: 16px;\n}\n\n.demo-section {\n  max-height: 100%;\n  overflow-y: auto;\n}\n\n.demo-controls {\n  margin-bottom: 20px;\n}\n\n.demo-button {\n  background: var(--accent-color, #4CAF50);\n  color: white;\n  border: none;\n  padding: 12px 20px;\n  border-radius: 6px;\n  font-size: 14px;\n  font-weight: 500;\n  cursor: pointer;\n  transition: background-color 0.2s;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n\n.demo-button:hover {\n  background: var(--accent-hover-color, #45a049);\n}\n\n.selected-result {\n  background: var(--bg-secondary, #333333);\n  border: 1px solid var(--border-color, #555555);\n  border-radius: 6px;\n  padding: 16px;\n  margin-bottom: 20px;\n}\n\n.selected-result h4 {\n  margin: 0 0 12px 0;\n  color: var(--accent-color, #4CAF50);\n  font-size: 14px;\n}\n\n.selected-result p {\n  margin: 6px 0;\n  font-size: 13px;\n  color: var(--text-color, #ffffff);\n  word-break: break-all;\n}\n\n.demo-explanation {\n  margin-bottom: 20px;\n}\n\n.demo-explanation h4,\n.demo-api h4 {\n  margin: 0 0 12px 0;\n  color: var(--text-color, #ffffff);\n  font-size: 14px;\n}\n\n.demo-explanation ul {\n  margin: 0;\n  padding-left: 20px;\n}\n\n.demo-explanation li {\n  margin: 8px 0;\n  font-size: 13px;\n  color: var(--text-secondary, #cccccc);\n  line-height: 1.4;\n}\n\n.code-block {\n  background: var(--bg-code, #1e1e1e);\n  border: 1px solid var(--border-color, #555555);\n  border-radius: 4px;\n  padding: 12px;\n  font-family: 'Consolas', 'Monaco', 'Courier New', monospace;\n  font-size: 12px;\n  color: var(--text-code, #d4d4d4);\n  overflow-x: auto;\n  white-space: pre;\n  margin: 0;\n  line-height: 1.4;\n}\n\n/* 预设管理样式 */\n.presets-section {\n  padding: 0;\n}\n\n.presets-section h3 {\n  margin: 0 0 16px 0;\n  color: #4CAF50;\n  font-size: 18px;\n  font-weight: 600;\n}\n\n.preset-message {\n  padding: 12px;\n  border-radius: 6px;\n  margin-bottom: 16px;\n  font-size: 14px;\n  font-weight: 500;\n}\n\n.preset-message.success {\n  background: rgba(76, 175, 80, 0.2);\n  border: 1px solid #4CAF50;\n  color: #4CAF50;\n}\n\n.preset-message.error {\n  background: rgba(244, 67, 54, 0.2);\n  border: 1px solid #f44336;\n  color: #f44336;\n}\n\n.preset-controls {\n  margin-bottom: 20px;\n}\n\n.preset-buttons {\n  display: flex;\n  gap: 8px;\n  flex-wrap: wrap;\n}\n\n.preset-btn {\n  padding: 8px 16px;\n  border: none;\n  border-radius: 6px;\n  font-size: 13px;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s;\n  display: flex;\n  align-items: center;\n  gap: 6px;\n}\n\n.preset-btn.primary {\n  background: #4CAF50;\n  color: white;\n}\n\n.preset-btn.primary:hover:not(:disabled) {\n  background: #45a049;\n  transform: translateY(-1px);\n}\n\n.preset-btn.secondary {\n  background: #2196F3;\n  color: white;\n}\n\n.preset-btn.secondary:hover:not(:disabled) {\n  background: #1976D2;\n  transform: translateY(-1px);\n}\n\n.preset-btn:not(.primary):not(.secondary) {\n  background: #666666;\n  color: white;\n}\n\n.preset-btn:not(.primary):not(.secondary):hover:not(:disabled) {\n  background: #777777;\n  transform: translateY(-1px);\n}\n\n.preset-btn:disabled {\n  opacity: 0.6;\n  cursor: not-allowed;\n  transform: none;\n}\n\n.preset-form {\n  background: #333333;\n  border-radius: 8px;\n  padding: 20px;\n  border: 1px solid #404040;\n  margin-top: 8px;\n}\n\n.form-group {\n  margin-bottom: 16px;\n}\n\n.form-group label {\n  display: block;\n  margin-bottom: 6px;\n  color: #cccccc;\n  font-size: 13px;\n  font-weight: 500;\n}\n\n.preset-input, .preset-textarea {\n  width: 100%;\n  padding: 10px 12px;\n  background: #2a2a2a;\n  border: 1px solid #555555;\n  border-radius: 4px;\n  color: #ffffff;\n  font-size: 13px;\n  box-sizing: border-box;\n  transition: border-color 0.2s;\n}\n\n.preset-input:focus, .preset-textarea:focus {\n  outline: none;\n  border-color: #4CAF50;\n}\n\n.preset-textarea {\n  resize: vertical;\n  min-height: 60px;\n  font-family: 'Consolas', 'Monaco', 'Courier New', monospace;\n}\n\n/* 路径列表样式 */\n.path-list {\n  background: #2a2a2a;\n  border: 1px solid #555555;\n  border-radius: 4px;\n  padding: 12px;\n  min-height: 120px;\n}\n\n.path-item {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 8px 12px;\n  margin-bottom: 8px;\n  background: #333333;\n  border-radius: 4px;\n  border: 1px solid #404040;\n  transition: all 0.2s;\n}\n\n.path-item:hover {\n  background: #3a3a3a;\n  border-color: #4CAF50;\n}\n\n.path-text {\n  flex: 1;\n  font-family: 'Consolas', 'Monaco', 'Courier New', monospace;\n  font-size: 13px;\n  color: #ffffff;\n  word-break: break-all;\n  margin-right: 12px;\n  line-height: 1.3;\n}\n\n.path-remove {\n  background: #f44336;\n  color: white;\n  border: none;\n  padding: 4px 8px;\n  border-radius: 3px;\n  cursor: pointer;\n  font-size: 12px;\n  transition: background-color 0.2s;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  min-width: 28px;\n  height: 28px;\n}\n\n.path-remove:hover {\n  background: #d32f2f;\n}\n\n.path-add {\n  background: #4CAF50;\n  color: white;\n  border: none;\n  padding: 10px 16px;\n  border-radius: 4px;\n  cursor: pointer;\n  font-size: 14px;\n  font-weight: 500;\n  transition: all 0.2s;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  width: 100%;\n  justify-content: center;\n  margin-top: 8px;\n}\n\n.path-add:hover {\n  background: #45a049;\n  transform: translateY(-1px);\n}\n\n.path-list:empty {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: #999999;\n  font-style: italic;\n}\n\n.path-list:empty::before {\n  content: "暂无路径，点击下方按钮添加";\n}\n\n/* 节点列表样式 */\n.node-list {\n  background: #2a2a2a;\n  border: 1px solid #555555;\n  border-radius: 4px;\n  padding: 12px;\n  min-height: 80px;\n}\n\n.node-item {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 8px 12px;\n  margin-bottom: 8px;\n  background: #333333;\n  border-radius: 4px;\n  border: 1px solid #404040;\n  transition: all 0.2s;\n}\n\n.node-item:hover {\n  background: #3a3a3a;\n  border-color: #2196F3;\n}\n\n.node-text {\n  flex: 1;\n  font-family: 'Consolas', 'Monaco', 'Courier New', monospace;\n  font-size: 13px;\n  color: #ffffff;\n  font-weight: 500;\n  margin-right: 12px;\n  line-height: 1.3;\n}\n\n.node-remove {\n  background: #f44336;\n  color: white;\n  border: none;\n  padding: 4px 8px;\n  border-radius: 3px;\n  cursor: pointer;\n  font-size: 12px;\n  transition: background-color 0.2s;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  min-width: 28px;\n  height: 28px;\n}\n\n.node-remove:hover {\n  background: #d32f2f;\n}\n\n.node-add {\n  background: #2196F3;\n  color: white;\n  border: none;\n  padding: 10px 16px;\n  border-radius: 4px;\n  cursor: pointer;\n  font-size: 14px;\n  font-weight: 500;\n  transition: all 0.2s;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  width: 100%;\n  justify-content: center;\n  margin-top: 8px;\n}\n\n.node-add:hover {\n  background: #1976D2;\n  transform: translateY(-1px);\n}\n\n.node-list:empty {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: #999999;\n  font-style: italic;\n}\n\n.node-list:empty::before {\n  content: "暂无节点类型，点击下方按钮添加";\n}\n\n.form-actions {\n  margin-top: 20px;\n}\n\n/* 预设选择器弹框样式在JavaScript中动态定义 */\n`,""]);const h=f},314:n=>{n.exports=function(n){var e=[];return e.toString=function(){return this.map(function(e){var t="",o=void 0!==e[5];return e[4]&&(t+="@supports (".concat(e[4],") {")),e[2]&&(t+="@media ".concat(e[2]," {")),o&&(t+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),t+=n(e),o&&(t+="}"),e[2]&&(t+="}"),e[4]&&(t+="}"),t}).join("")},e.i=function(n,t,o,r,a){"string"==typeof n&&(n=[[null,n,void 0]]);var i={};if(o)for(var s=0;s<this.length;s++){var l=this[s][0];null!=l&&(i[l]=!0)}for(var d=0;d<n.length;d++){var c=[].concat(n[d]);o&&i[c[0]]||(void 0!==a&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=a),t&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=t):c[2]=t),r&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=r):c[4]="".concat(r)),e.push(c))}},e}},401:n=>{n.exports="data:image/svg+xml,%3csvg xmlns=%27http://www.w3.org/2000/svg%27 fill=%27none%27 viewBox=%270 0 20 20%27%3e%3cpath stroke=%27%23999999%27 stroke-linecap=%27round%27 stroke-linejoin=%27round%27 stroke-width=%271.5%27 d=%27M6 8l4 4 4-4%27/%3e%3c/svg%3e"},417:n=>{n.exports=function(n,e){return e||(e={}),n?(n=String(n.__esModule?n.default:n),/^['"].*['"]$/.test(n)&&(n=n.slice(1,-1)),e.hash&&(n+=e.hash),/["'() \t\n]|(%20)/.test(n)||e.needQuotes?'"'.concat(n.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):n):n}},429:n=>{n.exports="data:image/svg+xml,%3csvg xmlns=%27http://www.w3.org/2000/svg%27 fill=%27none%27 viewBox=%270 0 20 20%27%3e%3cpath stroke=%27%23007acc%27 stroke-linecap=%27round%27 stroke-linejoin=%27round%27 stroke-width=%271.5%27 d=%27M6 8l4 4 4-4%27/%3e%3c/svg%3e"},526:(n,e,t)=>{t.d(e,{A:()=>s});var o=t(601),r=t.n(o),a=t(314),i=t.n(a)()(r());i.push([n.id,".floating-panel {\n  background: #2a2a2a;\n  border: 1px solid #404040;\n  border-radius: 8px;\n  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);\n  overflow: hidden;\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n  user-select: none;\n}\n\n.floating-panel-header {\n  background: #333333;\n  padding: 8px 12px;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  cursor: move;\n  border-bottom: 1px solid #404040;\n}\n\n.floating-panel-title {\n  color: #ffffff;\n  font-size: 14px;\n  font-weight: 500;\n  margin: 0;\n}\n\n.floating-panel-close {\n  background: none;\n  border: none;\n  color: #999999;\n  font-size: 18px;\n  cursor: pointer;\n  padding: 0;\n  width: 20px;\n  height: 20px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border-radius: 4px;\n  transition: background-color 0.2s;\n}\n\n.floating-panel-close:hover {\n  background: #555555;\n  color: #ffffff;\n}\n\n.floating-panel-content {\n  padding: 16px;\n  height: calc(100% - 41px);\n  overflow: auto;\n  color: #ffffff;\n}\n\n.floating-panel-resize-handle {\n  position: absolute;\n  bottom: 0;\n  right: 0;\n  width: 16px;\n  height: 16px;\n  cursor: se-resize;\n  background: linear-gradient(\n    -45deg,\n    transparent 40%,\n    #666666 40%,\n    #666666 60%,\n    transparent 60%\n  );\n}\n\n.floating-panel-resize-handle:hover {\n  background: linear-gradient(\n    -45deg,\n    transparent 40%,\n    #888888 40%,\n    #888888 60%,\n    transparent 60%\n  );\n}\n\n/* 滚动条样式 */\n.floating-panel-content::-webkit-scrollbar {\n  width: 6px;\n}\n\n.floating-panel-content::-webkit-scrollbar-track {\n  background: #1a1a1a;\n}\n\n.floating-panel-content::-webkit-scrollbar-thumb {\n  background: #555555;\n  border-radius: 3px;\n}\n\n.floating-panel-content::-webkit-scrollbar-thumb:hover {\n  background: #666666;\n} ",""]);const s=i},540:n=>{n.exports=function(n){var e=document.createElement("style");return n.setAttributes(e,n.attributes),n.insert(e,n.options),e}},567:n=>{n.exports="data:image/svg+xml,%3csvg xmlns=%27http://www.w3.org/2000/svg%27 fill=%27none%27 viewBox=%270 0 20 20%27%3e%3cpath stroke=%27%23666666%27 stroke-linecap=%27round%27 stroke-linejoin=%27round%27 stroke-width=%271.5%27 d=%27M6 8l4 4 4-4%27/%3e%3c/svg%3e"},601:n=>{n.exports=function(n){return n[1]}},659:n=>{var e={};n.exports=function(n,t){var o=function(n){if(void 0===e[n]){var t=document.querySelector(n);if(window.HTMLIFrameElement&&t instanceof window.HTMLIFrameElement)try{t=t.contentDocument.head}catch(n){t=null}e[n]=t}return e[n]}(n);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(t)}},825:n=>{n.exports=function(n){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=n.insertStyleElement(n);return{update:function(t){!function(n,e,t){var o="";t.supports&&(o+="@supports (".concat(t.supports,") {")),t.media&&(o+="@media ".concat(t.media," {"));var r=void 0!==t.layer;r&&(o+="@layer".concat(t.layer.length>0?" ".concat(t.layer):""," {")),o+=t.css,r&&(o+="}"),t.media&&(o+="}"),t.supports&&(o+="}");var a=t.sourceMap;a&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),e.styleTagTransform(o,n,e.options)}(e,n,t)},remove:function(){!function(n){if(null===n.parentNode)return!1;n.parentNode.removeChild(n)}(e)}}}},848:(n,e,t)=>{n.exports=t(20)},883:e=>{e.exports=n}},t={};function o(n){var r=t[n];if(void 0!==r)return r.exports;var a=t[n]={id:n,exports:{}};return e[n](a,a.exports,o),a.exports}o.m=e,o.n=n=>{var e=n&&n.__esModule?()=>n.default:()=>n;return o.d(e,{a:e}),e},o.d=(n,e)=>{for(var t in e)o.o(e,t)&&!o.o(n,t)&&Object.defineProperty(n,t,{enumerable:!0,get:e[t]})},o.o=(n,e)=>Object.prototype.hasOwnProperty.call(n,e),o.r=n=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},o.b=document.baseURI||self.location.href,o.nc=void 0;var r={};o.r(r),o.d(r,{FileSelector:()=>P,FloatingPanel:()=>w,ReiToolsAPI:()=>xn,ReiToolsPanel:()=>I,addNodeToCanvas:()=>B,cleanupUnconnectedNodes:()=>q,clearAllStorageData:()=>cn,connectNodes:()=>W,copyNodeInfo:()=>Y,createFileSelector:()=>E,createSystemFileSelector:()=>j,deleteSelectedNodes:()=>V,deleteWorkflowTemplate:()=>dn,exportWorkflow:()=>J,fetchFileSystemData:()=>C,fetchSystemFileSystemData:()=>k,getAllNodes:()=>H,getComfyUIApp:()=>D,getSelectedNodes:()=>O,importWorkflow:()=>K,initReiTools:()=>fn,isComfyUILoaded:()=>U,loadFromStorage:()=>nn,loadPanelConfig:()=>on,loadUserPreferences:()=>an,loadWorkflowTemplates:()=>ln,removeFromStorage:()=>en,savePanelConfig:()=>tn,saveToStorage:()=>Z,saveUserPreferences:()=>rn,saveWorkflowTemplate:()=>sn,selectDirectory:()=>L,selectFile:()=>T,selectImage:()=>$,selectLoraDirectory:()=>z,selectModelDirectory:()=>N,selectPythonFile:()=>A,selectSystemDirectory:()=>_,selectTextFile:()=>S});var a=o(848),i=o(883),s=o(72),l=o.n(s),d=o(825),c=o.n(d),p=o(659),u=o.n(p),f=o(56),x=o.n(f),m=o(540),g=o.n(m),b=o(113),h=o.n(b),y=o(526),v={};v.styleTagTransform=h(),v.setAttributes=x(),v.insert=u().bind(null,"head"),v.domAPI=c(),v.insertStyleElement=g(),l()(y.A,v),y.A&&y.A.locals&&y.A.locals;const w=({title:n="工具面板",visible:e=!0,position:t={x:100,y:100},size:o={width:400,height:300},onClose:r,onMove:s,onResize:l,children:d,className:c="",zIndex:p=1e3})=>{const[u,f]=(0,i.useState)(t),[x,m]=(0,i.useState)(o),[g,b]=(0,i.useState)(!1),[h,y]=(0,i.useState)(!1),[v,w]=(0,i.useState)({x:0,y:0}),C=(0,i.useRef)(null),k=(0,i.useCallback)(n=>{(n.target===n.currentTarget||n.target.classList.contains("floating-panel-header"))&&(b(!0),w({x:n.clientX-u.x,y:n.clientY-u.y}),n.preventDefault())},[u]),E=(0,i.useCallback)(n=>{if(g){const e={x:n.clientX-v.x,y:n.clientY-v.y};f(e),s?.(e)}},[g,v,s]),j=(0,i.useCallback)(()=>{b(!1),y(!1)},[]),T=(0,i.useCallback)(n=>{y(!0),n.preventDefault(),n.stopPropagation()},[]),L=(0,i.useCallback)(n=>{if(h&&C.current){const e=C.current.getBoundingClientRect(),t={width:Math.max(200,n.clientX-e.left),height:Math.max(150,n.clientY-e.top)};m(t),l?.(t)}},[h,l]);return(0,i.useEffect)(()=>(g&&(document.addEventListener("mousemove",E),document.addEventListener("mouseup",j)),h&&(document.addEventListener("mousemove",L),document.addEventListener("mouseup",j)),()=>{document.removeEventListener("mousemove",E),document.removeEventListener("mousemove",L),document.removeEventListener("mouseup",j)}),[g,h,E,L,j]),e?(0,a.jsxs)("div",{ref:C,className:`floating-panel ${c}`,style:{position:"fixed",left:u.x,top:u.y,width:x.width,height:x.height,zIndex:p},onMouseDown:k,children:[(0,a.jsxs)("div",{className:"floating-panel-header",children:[(0,a.jsx)("span",{className:"floating-panel-title",children:n}),r&&(0,a.jsx)("button",{className:"floating-panel-close",onClick:r,type:"button",children:"×"})]}),(0,a.jsx)("div",{className:"floating-panel-content",children:d}),(0,a.jsx)("div",{className:"floating-panel-resize-handle",onMouseDown:T})]}):null};async function C(n="",e=!0){try{const t=await fetch(`/api/rei/filesystem/browse?path=${encodeURIComponent(n)}&show_files=${e}`);if(!t.ok){const n=await t.json();throw new Error(n.error||"获取目录内容失败")}return await t.json()}catch(n){throw console.error("获取文件系统数据失败:",n),n}}async function k(n="",e=!0){try{const t=await fetch(`/api/rei/filesystem/browse-system?path=${encodeURIComponent(n)}&show_files=${e}`);if(!t.ok){const n=await t.json();throw new Error(n.error||"获取系统目录内容失败")}return await t.json()}catch(n){throw console.error("获取系统文件系统数据失败:",n),n}}function E(n={}){const{mode:e="both",title:t="选择文件",allowedExtensions:o=[],initialPath:r=""}=n;return new Promise((e,t)=>{!async function(n,e,t){const{mode:o="both",title:r="选择文件",allowedExtensions:a=[],initialPath:i=""}=n;let s=i,l=null,d=null;const c=document.createElement("div");c.className="file-selector-overlay",c.style.cssText="\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background-color: rgba(0, 0, 0, 0.7);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    z-index: 10000;\n  ";const p=document.createElement("div");p.className="file-selector-modal",p.style.cssText="\n    background: #2b2b2b;\n    border-radius: 8px;\n    width: 80%;\n    max-width: 800px;\n    height: 80%;\n    max-height: 600px;\n    display: flex;\n    flex-direction: column;\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);\n    color: #ffffff;\n  ";const u=document.createElement("div");u.style.cssText="\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 16px 20px;\n    border-bottom: 1px solid #404040;\n    background: #333333;\n    border-radius: 8px 8px 0 0;\n  ";const f=document.createElement("h3");f.textContent=r,f.style.cssText="\n    margin: 0;\n    font-size: 18px;\n    font-weight: 600;\n    color: #ffffff;\n  ";const x=document.createElement("button");x.textContent="×",x.style.cssText="\n    background: none;\n    border: none;\n    font-size: 24px;\n    color: #ffffff;\n    cursor: pointer;\n    padding: 0;\n    width: 30px;\n    height: 30px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    border-radius: 4px;\n    transition: background-color 0.2s;\n  ",x.addEventListener("click",()=>{document.body.removeChild(c),t(new Error("用户取消选择"))}),x.addEventListener("mouseover",()=>{x.style.backgroundColor="#555555"}),x.addEventListener("mouseout",()=>{x.style.backgroundColor="transparent"}),u.appendChild(f),u.appendChild(x);const m=document.createElement("div");m.style.cssText="\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 12px 20px;\n    border-bottom: 1px solid #404040;\n    background: #2a2a2a;\n    flex-wrap: wrap;\n    gap: 8px;\n  ";const g=document.createElement("div");g.style.cssText="\n    font-size: 14px;\n    color: #cccccc;\n    flex: 1;\n    min-width: 0;\n  ";const b=document.createElement("button");b.textContent="⬆️ 返回上级",b.style.cssText="\n    background: #444444;\n    border: 1px solid #666666;\n    color: #ffffff;\n    padding: 6px 12px;\n    border-radius: 4px;\n    cursor: pointer;\n    font-size: 14px;\n    transition: all 0.2s;\n  ",b.addEventListener("mouseover",()=>{b.disabled||(b.style.backgroundColor="#555555",b.style.borderColor="#4CAF50")}),b.addEventListener("mouseout",()=>{b.disabled||(b.style.backgroundColor="#444444",b.style.borderColor="#666666")}),m.appendChild(g),m.appendChild(b);const h=document.createElement("div");h.style.cssText="\n    display: flex;\n    align-items: center;\n    gap: 16px;\n    padding: 8px 20px;\n    background: rgba(76, 175, 80, 0.1);\n    border-bottom: 1px solid #404040;\n    font-size: 12px;\n    color: #cccccc;\n  ";const y=document.createElement("div");y.style.cssText="\n    flex: 1;\n    overflow-y: auto;\n    padding: 8px;\n  ";const v=document.createElement("div");v.style.cssText="\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 16px 20px;\n    border-top: 1px solid #404040;\n    background: #2a2a2a;\n    border-radius: 0 0 8px 8px;\n  ";const w=document.createElement("div");w.style.cssText="\n    font-size: 14px;\n    color: #cccccc;\n    flex: 1;\n  ";const C=document.createElement("div");C.style.cssText="\n    display: flex;\n    gap: 12px;\n  ";const k=document.createElement("button");k.textContent="取消",k.style.cssText="\n    background: #666666;\n    color: #ffffff;\n    border: none;\n    padding: 8px 16px;\n    border-radius: 4px;\n    cursor: pointer;\n    font-size: 14px;\n    font-weight: 500;\n    transition: background-color 0.2s;\n  ",k.addEventListener("mouseover",()=>{k.style.backgroundColor="#777777"}),k.addEventListener("mouseout",()=>{k.style.backgroundColor="#666666"});const E=document.createElement("button");async function j(t){y.innerHTML='<div style="text-align: center; padding: 40px; color: #cccccc; font-size: 16px;">📂 加载中...</div>',g.innerHTML="加载中...",h.innerHTML="",l=null,w.textContent="",E.disabled=!0,E.style.opacity="0.5",E.style.cursor="not-allowed";try{const r="file"===o||"both"===o;let i=`/api/rei/filesystem/browse?path=${encodeURIComponent(t)}&show_files=${r}`;n.baseDir&&(i+=`&base_dir=${encodeURIComponent(n.baseDir)}`),a.length>0&&(i+=`&file_types=${a.join(",")}`);const p=await fetch(i);if(!p.ok){const n=await p.json();throw new Error(n.error||`HTTP ${p.status}: ${p.statusText}`)}const u=await p.json();if("directory"!==u.type)throw new Error("响应数据格式错误");if(s=u.path,d=u.parent_path,g.innerHTML=`\n        <span style="color: #999;">当前路径:</span>\n        <span style="color: #4CAF50; font-family: monospace; margin-left: 8px; font-weight: bold;">\n          ${u.path||"根目录"}\n        </span>\n      `,h.innerHTML=`\n        <span>📂 ${u.total_directories} 个文件夹</span>\n        <span>📄 ${u.total_files} 个文件</span>\n        <span>📊 共 ${u.total_items} 项</span>\n      `,b.disabled=null===d,b.style.opacity=null===d?"0.5":"1",b.style.cursor=null===d?"not-allowed":"pointer",y.innerHTML="",0===u.items.length)return void(y.innerHTML='\n          <div style="text-align: center; padding: 60px 20px; color: #999999;">\n            <div style="font-size: 48px; margin-bottom: 16px;">📂</div>\n            <div style="font-size: 16px; margin-bottom: 8px;">此目录为空</div>\n            <div style="font-size: 14px; color: #666;">没有符合条件的文件或文件夹</div>\n          </div>\n        ');u.items.forEach(n=>{const t=document.createElement("div");t.style.cssText="\n          display: flex;\n          align-items: center;\n          padding: 12px 16px;\n          margin: 2px 0;\n          border-radius: 6px;\n          cursor: pointer;\n          transition: all 0.2s;\n          border: 2px solid transparent;\n        ",t.addEventListener("mouseenter",()=>{t.classList.contains("selected")||(t.style.backgroundColor="rgba(255, 255, 255, 0.1)")}),t.addEventListener("mouseleave",()=>{t.classList.contains("selected")||(t.style.backgroundColor="transparent")});const r=document.createElement("div");r.style.cssText="\n          font-size: 20px;\n          margin-right: 12px;\n          width: 24px;\n          text-align: center;\n        ",r.textContent=n.icon||("directory"===n.type?"📁":"📄");const a=document.createElement("div");a.style.cssText="flex: 1; min-width: 0;";const i=document.createElement("div");i.style.cssText="\n          font-size: 14px;\n          font-weight: 500;\n          color: #ffffff;\n          margin-bottom: 2px;\n          word-break: break-word;\n        ",i.textContent=n.name;const s=document.createElement("div");if(s.style.cssText="\n          font-size: 12px;\n          color: #999999;\n        ","directory"===n.type){let e=`${n.children_count||0} 项`;void 0!==n.file_count&&void 0!==n.dir_count&&(e+=` (${n.dir_count} 文件夹, ${n.file_count} 文件)`),s.innerHTML=e}else{let e=function(n){if(0===n)return"0 B";const e=Math.floor(Math.log(n)/Math.log(1024));return parseFloat((n/Math.pow(1024,e)).toFixed(2))+" "+["B","KB","MB","GB"][e]}(n.size||0);n.extension&&(e+=` <span style="color: #4CAF50; font-weight: 500; margin-left: 4px;">.${n.extension}</span>`),n.modified&&(e+=` • ${d=n.modified,new Date(1e3*d).toLocaleString("zh-CN")}`),s.innerHTML=e}var d;if(a.appendChild(i),a.appendChild(s),!1===n.is_readable){const n=document.createElement("div");n.style.cssText="\n            font-size: 11px;\n            color: #f44336;\n            margin-top: 2px;\n          ",n.textContent="⚠️ 无读取权限",a.appendChild(n)}t.appendChild(r),t.appendChild(a),t.addEventListener("click",()=>{y.querySelectorAll(".selected").forEach(n=>{n.classList.remove("selected"),n.style.backgroundColor="transparent",n.style.borderColor="transparent"}),t.classList.add("selected"),t.style.backgroundColor="rgba(76, 175, 80, 0.2)",t.style.borderColor="#4CAF50",l=n,w.textContent=`已选择: ${n.name} (${"directory"===n.type?"文件夹":"文件"})`;const e="both"===o||"file"===o&&"file"===n.type||"directory"===o&&"directory"===n.type;E.disabled=!e,E.style.opacity=e?"1":"0.5",E.style.cursor=e?"pointer":"not-allowed"}),t.addEventListener("dblclick",()=>{"directory"===n.type?j(n.path):"file"!==o&&"both"!==o||(document.body.removeChild(c),e({path:n.path,type:n.type,name:n.name}))}),y.appendChild(t)})}catch(n){y.innerHTML=`\n        <div style="text-align: center; padding: 60px 20px; color: #f44336;">\n          <div style="font-size: 48px; margin-bottom: 16px;">❌</div>\n          <div style="font-size: 16px; margin-bottom: 8px;">加载失败</div>\n          <div style="font-size: 14px; color: #999;">${n instanceof Error?n.message:"未知错误"}</div>\n          <button onclick="location.reload()" style="\n            margin-top: 16px;\n            background: #4CAF50;\n            color: white;\n            border: none;\n            padding: 8px 16px;\n            border-radius: 4px;\n            cursor: pointer;\n          ">重试</button>\n        </div>\n      `,g.innerHTML='<span style="color: #f44336;">加载失败</span>',h.innerHTML=""}}E.textContent="确认选择",E.style.cssText="\n    background: #4CAF50;\n    color: white;\n    border: none;\n    padding: 8px 16px;\n    border-radius: 4px;\n    cursor: pointer;\n    font-size: 14px;\n    font-weight: 500;\n    transition: background-color 0.2s;\n  ",E.disabled=!0,E.style.opacity="0.5",E.style.cursor="not-allowed",E.addEventListener("mouseover",()=>{E.disabled||(E.style.backgroundColor="#45a049")}),E.addEventListener("mouseout",()=>{E.disabled||(E.style.backgroundColor="#4CAF50")}),C.appendChild(k),C.appendChild(E),v.appendChild(w),v.appendChild(C),k.addEventListener("click",()=>{document.body.removeChild(c),t(new Error("用户取消选择"))}),E.addEventListener("click",()=>{l&&(document.body.removeChild(c),e({path:l.path,type:l.type,name:l.name}))}),b.addEventListener("click",()=>{null!==d&&j(d)}),p.appendChild(u),p.appendChild(m),p.appendChild(h),p.appendChild(y),p.appendChild(v),c.appendChild(p),p.addEventListener("click",n=>{n.stopPropagation()}),c.addEventListener("click",()=>{document.body.removeChild(c),t(new Error("用户取消选择"))}),document.body.appendChild(c),j(s)}(n,e,t)})}function j(n={}){const{mode:e="both",title:t="选择文件",allowedExtensions:o=[],initialPath:r=""}=n;return new Promise((e,t)=>{!async function(n,e,t){const{mode:o="both",title:r="选择文件",allowedExtensions:a=[],initialPath:i=""}=n;let s=i,l=null,d=null;const c=document.createElement("div");c.className="file-selector-overlay",c.style.cssText="\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background-color: rgba(0, 0, 0, 0.7);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    z-index: 10000;\n  ";const p=document.createElement("div");p.className="file-selector-modal",p.style.cssText="\n    background: #2b2b2b;\n    border-radius: 8px;\n    width: 80%;\n    max-width: 800px;\n    height: 80%;\n    max-height: 600px;\n    display: flex;\n    flex-direction: column;\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);\n    color: #ffffff;\n  ";const u=document.createElement("div");u.style.cssText="\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 16px 20px;\n    border-bottom: 1px solid #404040;\n    background: #333333;\n    border-radius: 8px 8px 0 0;\n  ";const f=document.createElement("h3");f.textContent=r,f.style.cssText="\n    margin: 0;\n    font-size: 18px;\n    font-weight: 600;\n    color: #ffffff;\n  ";const x=document.createElement("button");x.textContent="×",x.style.cssText="\n    background: none;\n    border: none;\n    font-size: 24px;\n    color: #ffffff;\n    cursor: pointer;\n    padding: 0;\n    width: 30px;\n    height: 30px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    border-radius: 4px;\n    transition: background-color 0.2s;\n  ",x.addEventListener("click",()=>{document.body.removeChild(c),t(new Error("用户取消选择"))}),x.addEventListener("mouseover",()=>{x.style.backgroundColor="#555555"}),x.addEventListener("mouseout",()=>{x.style.backgroundColor="transparent"}),u.appendChild(f),u.appendChild(x);const m=document.createElement("div");m.style.cssText="\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 12px 20px;\n    border-bottom: 1px solid #404040;\n    background: #2a2a2a;\n    flex-wrap: wrap;\n    gap: 8px;\n  ";const g=document.createElement("div");g.style.cssText="\n    font-size: 14px;\n    color: #cccccc;\n    flex: 1;\n    min-width: 0;\n  ";const b=document.createElement("button");b.textContent="⬆️ 返回上级",b.style.cssText="\n    background: #444444;\n    border: 1px solid #666666;\n    color: #ffffff;\n    padding: 6px 12px;\n    border-radius: 4px;\n    cursor: pointer;\n    font-size: 14px;\n    transition: all 0.2s;\n  ",b.addEventListener("mouseover",()=>{b.disabled||(b.style.backgroundColor="#555555",b.style.borderColor="#4CAF50")}),b.addEventListener("mouseout",()=>{b.disabled||(b.style.backgroundColor="#444444",b.style.borderColor="#666666")}),m.appendChild(g),m.appendChild(b);const h=document.createElement("div");h.style.cssText="\n    display: flex;\n    align-items: center;\n    gap: 16px;\n    padding: 8px 20px;\n    background: rgba(76, 175, 80, 0.1);\n    border-bottom: 1px solid #404040;\n    font-size: 12px;\n    color: #cccccc;\n  ";const y=document.createElement("div");y.style.cssText="\n    flex: 1;\n    overflow-y: auto;\n    padding: 8px;\n  ";const v=document.createElement("div");v.style.cssText="\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 16px 20px;\n    border-top: 1px solid #404040;\n    background: #2a2a2a;\n    border-radius: 0 0 8px 8px;\n  ";const w=document.createElement("div");w.style.cssText="\n    font-size: 14px;\n    color: #cccccc;\n    flex: 1;\n  ";const C=document.createElement("div");C.style.cssText="\n    display: flex;\n    gap: 12px;\n  ";const k=document.createElement("button");k.textContent="取消",k.style.cssText="\n    background: #666666;\n    color: #ffffff;\n    border: none;\n    padding: 8px 16px;\n    border-radius: 4px;\n    cursor: pointer;\n    font-size: 14px;\n    font-weight: 500;\n    transition: background-color 0.2s;\n  ",k.addEventListener("mouseover",()=>{k.style.backgroundColor="#777777"}),k.addEventListener("mouseout",()=>{k.style.backgroundColor="#666666"});const E=document.createElement("button");async function j(n){y.innerHTML='<div style="text-align: center; padding: 40px; color: #cccccc; font-size: 16px;">📂 加载中...</div>',g.innerHTML="加载中...",h.innerHTML="",l=null,w.textContent="",E.disabled=!0,E.style.opacity="0.5",E.style.cursor="not-allowed";try{const t="file"===o||"both"===o;let r=`/api/rei/filesystem/browse-system?path=${encodeURIComponent(n)}&show_files=${t}`;a.length>0&&(r+=`&file_types=${a.join(",")}`);const i=await fetch(r);if(!i.ok){const n=await i.json();throw new Error(n.error||`HTTP ${i.status}: ${i.statusText}`)}const p=await i.json();if("directory"!==p.type)throw new Error("响应数据格式错误");if(s=p.path,d=p.parent_path,g.innerHTML=`\n        <span style="color: #999;">当前路径:</span>\n        <span style="color: #4CAF50; font-family: monospace; margin-left: 8px; font-weight: bold;">\n          ${p.path||"系统根目录"}\n        </span>\n      `,h.innerHTML=`\n        <span>📂 ${p.total_directories} 个文件夹</span>\n        <span>📄 ${p.total_files} 个文件</span>\n        <span>📊 共 ${p.total_items} 项</span>\n      `,b.disabled=null===d,b.style.opacity=null===d?"0.5":"1",b.style.cursor=null===d?"not-allowed":"pointer",y.innerHTML="",0===p.items.length)return void(y.innerHTML='\n          <div style="text-align: center; padding: 60px 20px; color: #999999;">\n            <div style="font-size: 48px; margin-bottom: 16px;">📂</div>\n            <div style="font-size: 16px; margin-bottom: 8px;">此目录为空</div>\n            <div style="font-size: 14px; color: #666;">没有符合条件的文件或文件夹</div>\n          </div>\n        ');p.items.forEach(n=>{const t=document.createElement("div");t.style.cssText="\n          display: flex;\n          align-items: center;\n          padding: 12px 16px;\n          margin: 2px 0;\n          border-radius: 6px;\n          cursor: pointer;\n          transition: all 0.2s;\n          border: 2px solid transparent;\n        ",t.addEventListener("mouseenter",()=>{t.classList.contains("selected")||(t.style.backgroundColor="rgba(255, 255, 255, 0.1)")}),t.addEventListener("mouseleave",()=>{t.classList.contains("selected")||(t.style.backgroundColor="transparent")});const r=document.createElement("div");r.style.cssText="\n          font-size: 20px;\n          margin-right: 12px;\n          width: 24px;\n          text-align: center;\n        ",r.textContent=n.icon||("directory"===n.type?"📁":"📄");const a=document.createElement("div");a.style.cssText="flex: 1; min-width: 0;";const i=document.createElement("div");i.style.cssText="\n          font-size: 14px;\n          font-weight: 500;\n          color: #ffffff;\n          margin-bottom: 2px;\n          word-break: break-word;\n        ",i.textContent=n.name;const s=document.createElement("div");if(s.style.cssText="\n          font-size: 12px;\n          color: #999999;\n        ","directory"===n.type){let e=`${n.children_count||0} 项`;void 0!==n.file_count&&void 0!==n.dir_count&&(e+=` (${n.dir_count} 文件夹, ${n.file_count} 文件)`),s.innerHTML=e}else{let e=function(n){if(0===n)return"0 B";const e=Math.floor(Math.log(n)/Math.log(1024));return parseFloat((n/Math.pow(1024,e)).toFixed(2))+" "+["B","KB","MB","GB"][e]}(n.size||0);n.extension&&(e+=` <span style="color: #4CAF50; font-weight: 500; margin-left: 4px;">.${n.extension}</span>`),n.modified&&(e+=` • ${d=n.modified,new Date(1e3*d).toLocaleString("zh-CN")}`),s.innerHTML=e}var d;if(a.appendChild(i),a.appendChild(s),!1===n.is_readable){const n=document.createElement("div");n.style.cssText="\n            font-size: 11px;\n            color: #f44336;\n            margin-top: 2px;\n          ",n.textContent="⚠️ 无读取权限",a.appendChild(n)}t.appendChild(r),t.appendChild(a),t.addEventListener("click",()=>{y.querySelectorAll(".selected").forEach(n=>{n.classList.remove("selected"),n.style.backgroundColor="transparent",n.style.borderColor="transparent"}),t.classList.add("selected"),t.style.backgroundColor="rgba(76, 175, 80, 0.2)",t.style.borderColor="#4CAF50",l=n,w.textContent=`已选择: ${n.name} (${"directory"===n.type?"文件夹":"文件"})`;const e="both"===o||"file"===o&&"file"===n.type||"directory"===o&&"directory"===n.type;E.disabled=!e,E.style.opacity=e?"1":"0.5",E.style.cursor=e?"pointer":"not-allowed"}),t.addEventListener("dblclick",()=>{"directory"===n.type?j(n.path):"file"!==o&&"both"!==o||(document.body.removeChild(c),e({path:n.path,type:n.type,name:n.name}))}),y.appendChild(t)})}catch(n){y.innerHTML=`\n        <div style="text-align: center; padding: 60px 20px; color: #f44336;">\n          <div style="font-size: 48px; margin-bottom: 16px;">❌</div>\n          <div style="font-size: 16px; margin-bottom: 8px;">加载失败</div>\n          <div style="font-size: 14px; color: #999;">${n instanceof Error?n.message:"未知错误"}</div>\n          <button onclick="location.reload()" style="\n            margin-top: 16px;\n            background: #4CAF50;\n            color: white;\n            border: none;\n            padding: 8px 16px;\n            border-radius: 4px;\n            cursor: pointer;\n          ">重试</button>\n        </div>\n      `,g.innerHTML='<span style="color: #f44336;">加载失败</span>',h.innerHTML=""}}E.textContent="确认选择",E.style.cssText="\n    background: #4CAF50;\n    color: white;\n    border: none;\n    padding: 8px 16px;\n    border-radius: 4px;\n    cursor: pointer;\n    font-size: 14px;\n    font-weight: 500;\n    transition: background-color 0.2s;\n  ",E.disabled=!0,E.style.opacity="0.5",E.style.cursor="not-allowed",E.addEventListener("mouseover",()=>{E.disabled||(E.style.backgroundColor="#45a049")}),E.addEventListener("mouseout",()=>{E.disabled||(E.style.backgroundColor="#4CAF50")}),C.appendChild(k),C.appendChild(E),v.appendChild(w),v.appendChild(C),k.addEventListener("click",()=>{document.body.removeChild(c),t(new Error("用户取消选择"))}),E.addEventListener("click",()=>{l&&(document.body.removeChild(c),e({path:l.path,type:l.type,name:l.name}))}),b.addEventListener("click",()=>{null!==d&&j(d)}),p.appendChild(u),p.appendChild(m),p.appendChild(h),p.appendChild(y),p.appendChild(v),c.appendChild(p),p.addEventListener("click",n=>{n.stopPropagation()}),c.addEventListener("click",()=>{document.body.removeChild(c),t(new Error("用户取消选择"))}),document.body.appendChild(c),j(s)}(n,e,t)})}async function T(n){return E({mode:"file",title:"选择文件",allowedExtensions:n})}async function L(n){return E({mode:"directory",title:"选择文件夹",baseDir:n})}async function N(){return E({mode:"directory",title:"选择模型文件夹",baseDir:"models"})}async function z(){return E({mode:"directory",title:"选择Lora文件夹",baseDir:"models"})}async function _(){return j({mode:"directory",title:"选择系统文件夹"})}async function $(){return T(["png","jpg","jpeg","gif","webp","bmp","svg"])}async function S(){return T(["txt","md","json","csv","log"])}async function A(){return T(["py","pyw"])}const P={create:E,selectFile:T,selectDirectory:L,selectModelDirectory:N,selectLoraDirectory:z,selectSystemDirectory:_,selectImage:$,selectTextFile:S,selectPythonFile:A,fetchFileSystemData:C,fetchSystemFileSystemData:k},F=P;var R=o(267),M={};M.styleTagTransform=h(),M.setAttributes=x(),M.insert=u().bind(null,"head"),M.domAPI=c(),M.insertStyleElement=g(),l()(R.A,M),R.A&&R.A.locals&&R.A.locals;const I=({visible:n=!0,onClose:e})=>{const[t,o]=(0,i.useState)("paramFocus"),[r,s]=(0,i.useState)([]),[l,d]=(0,i.useState)({}),[c,p]=(0,i.useState)(null),[u,f]=(0,i.useState)(null),[x,m]=(0,i.useState)(!1),[g,b]=(0,i.useState)(null),[h,y]=(0,i.useState)(""),[v,C]=(0,i.useState)(""),[k,E]=(0,i.useState)(""),[j,T]=(0,i.useState)(""),[L,N]=(0,i.useState)([]),[z,_]=(0,i.useState)([]),[$,S]=(0,i.useState)(["CheckpointLoaderSimple","UNETLoader"]),[A,P]=(0,i.useState)(["LoraLoader"]),R=n=>{o(n)},M=async n=>{T("正在加载...");try{const e=await fetch(`/api/rei/presets/get/${encodeURIComponent(n)}`);if(!e.ok)throw new Error(`HTTP ${e.status}: ${e.statusText}`);const t=await e.json();b(t),y(t.name),C(t.title||""),E(t.description||""),N(t.content?.modelPaths||[]),_(t.content?.loraPaths||[]),S(t.content?.modelLoaderNodes||["CheckpointLoaderSimple","UNETLoader"]),P(t.content?.loraLoaderNodes||["LoraLoader"]),T(`预设 "${t.title||t.name}" 加载成功`),D("preset update")}catch(n){T(`加载预设失败: ${n instanceof Error?n.message:"未知错误"}`)}},I=(n,e,t)=>{const o=(()=>{try{const n=window.comfyUIAPP;if(n&&n.graph&&n.graph._nodes){const e=new Set;return n.graph._nodes.forEach(n=>{n.type&&e.add(n.type)}),Array.from(e).sort()}return[]}catch(n){return console.error("获取画布节点类型失败:",n),[]}})();if(0===o.length)return void T("当前画布上没有节点，请先添加一些节点到画布上");const r=document.createElement("div");r.className="node-selector-overlay",r.style.cssText="\n      position: fixed;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background-color: rgba(0, 0, 0, 0.7);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      z-index: 10000;\n    ";const a=document.createElement("div");a.className="node-selector-modal",a.style.cssText="\n      background: #2b2b2b;\n      border-radius: 8px;\n      width: 80%;\n      max-width: 500px;\n      max-height: 70%;\n      display: flex;\n      flex-direction: column;\n      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);\n      color: #ffffff;\n    ";const i=document.createElement("div");i.style.cssText="\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      padding: 16px 20px;\n      border-bottom: 1px solid #404040;\n      background: #333333;\n      border-radius: 8px 8px 0 0;\n    ";const s=document.createElement("h3");s.textContent=t,s.style.cssText="\n      margin: 0;\n      font-size: 18px;\n      font-weight: 600;\n      color: #4CAF50;\n    ";const l=document.createElement("button");l.textContent="×",l.style.cssText="\n      background: none;\n      border: none;\n      font-size: 24px;\n      color: #ffffff;\n      cursor: pointer;\n      padding: 0;\n      width: 30px;\n      height: 30px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      border-radius: 4px;\n      transition: background-color 0.2s;\n    ",l.addEventListener("click",()=>{document.body.removeChild(r)}),l.addEventListener("mouseover",()=>{l.style.backgroundColor="#555555"}),l.addEventListener("mouseout",()=>{l.style.backgroundColor="transparent"}),i.appendChild(s),i.appendChild(l);const d=document.createElement("div");d.style.cssText="\n      flex: 1;\n      overflow-y: auto;\n      padding: 8px;\n    ";const c=document.createElement("div");c.style.cssText="\n      padding: 12px 16px;\n      background: rgba(76, 175, 80, 0.1);\n      border: 1px solid #4CAF50;\n      border-radius: 6px;\n      margin: 8px;\n      font-size: 13px;\n      color: #4CAF50;\n    ",c.textContent=`在画布上找到 ${o.length} 种节点类型，点击选择要添加的类型：`,d.appendChild(c),o.forEach(t=>{const o=n.includes(t),a=document.createElement("div");a.style.cssText=`\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        padding: 12px 16px;\n        margin: 4px 8px;\n        background: ${o?"rgba(76, 175, 80, 0.2)":"#333333"};\n        border-radius: 6px;\n        cursor: ${o?"default":"pointer"};\n        transition: all 0.2s;\n        border: 2px solid ${o?"#4CAF50":"transparent"};\n      `,o||(a.addEventListener("mouseenter",()=>{a.style.backgroundColor="#3a3a3a",a.style.borderColor="#4CAF50"}),a.addEventListener("mouseleave",()=>{a.style.backgroundColor="#333333",a.style.borderColor="transparent"}));const i=document.createElement("div");i.style.cssText="flex: 1; min-width: 0;";const s=document.createElement("div");s.style.cssText="\n        font-size: 14px;\n        font-weight: 600;\n        color: #ffffff;\n        margin-bottom: 2px;\n      ",s.textContent=t;const l=document.createElement("div");l.style.cssText=`\n        font-size: 12px;\n        color: ${o?"#4CAF50":"#999999"};\n      `,l.textContent=o?"已添加":"点击添加",i.appendChild(s),i.appendChild(l);const c=document.createElement("button");c.textContent=o?"✓":"+",c.style.cssText=`\n        background: ${o?"#4CAF50":"#666666"};\n        color: white;\n        border: none;\n        padding: 8px 12px;\n        border-radius: 4px;\n        cursor: ${o?"default":"pointer"};\n        font-size: 14px;\n        font-weight: bold;\n        transition: background-color 0.2s;\n        min-width: 40px;\n      `,o?c.disabled=!0:(c.addEventListener("click",n=>{n.stopPropagation(),document.body.removeChild(r),e(t)}),c.addEventListener("mouseover",()=>{c.style.backgroundColor="#4CAF50"}),c.addEventListener("mouseout",()=>{c.style.backgroundColor="#666666"}),a.addEventListener("click",()=>{document.body.removeChild(r),e(t)})),a.appendChild(i),a.appendChild(c),d.appendChild(a)}),a.appendChild(i),a.appendChild(d),r.appendChild(a),a.addEventListener("click",n=>{n.stopPropagation()}),r.addEventListener("click",()=>{document.body.removeChild(r)}),document.body.appendChild(r)},D=(0,i.useCallback)(n=>{console.log("%c [ by ]-707","font-size:13px; background:pink; color:#bf2c9f;",n,L);const e=window.comfyUIAPP?.graph._nodes,t=e.filter(n=>"PrimitiveNode"===n.type),o=[],r={};t.forEach(n=>{n.outputs?.length>0&&n.outputs[0].links?.length>0&&n.outputs[0].links.forEach(e=>{const t=window.comfyUIAPP?.graph?.links[e];if(t){const e=t.type,a=window.comfyUIAPP?.graph?.getNodeById(t.target_id),i=a.inputs[t.target_slot],s=n.widgets.find(n=>"value"===n.name);let l=s?.options?.values||[];console.log("%c [ modelLoaderNodes ]-747","font-size:13px; background:pink; color:#bf2c9f;",$,L,A,z,a.type,Array.isArray($)&&Array.isArray(L)&&L?.length>0&&$?.includes(a.type)||Array.isArray(A)&&Array.isArray(z)&&z?.length>0&&A?.includes(a.type)),Array.isArray($)&&Array.isArray(L)&&L?.length>0&&$?.includes(a.type)?l=l.filter(n=>{if(!n.includes("\\")&&!n.includes("/"))return!0;return!!L.find(e=>{const t=e.includes("\\")?"\\":"/",o=e.split(t).slice(1);return console.log('%c [ newPath.join("/") + "/" ]-763',"font-size:13px; background:pink; color:#bf2c9f;",o.join("/")+"/"),console.log('%c [  option.startsWith(newPath.join("\\") + "\\") ]-766',"font-size:13px; background:pink; color:#bf2c9f;",o.join("\\")+"\\"),n.startsWith(o.join("/")+"/")||n.startsWith(o.join("\\")+"\\")})}):Array.isArray(A)&&Array.isArray(z)&&z?.length>0&&A?.includes(a.type)&&(l=l.filter(n=>!n.includes("\\")&&!n.includes("/")||!!z.find(e=>{const t=e.includes("\\")?"\\":"/",o=e.split(t).slice(1);return n.startsWith(o.join("/")+"/")||n.startsWith(o.join("\\")+"\\")}))),o.push({target_id:t.target_id,target_slot:t.target_slot,id:t.origin_id,name:i?.localized_name||i?.name,type:"string"===e.toLowerCase()?s.type:e,title:a.title,comboOptions:l}),s&&(r[`${t.origin_id}_${t.target_id}_${t.target_slot}`]=s.value)}})}),s(o),d(r)},[L,z,$,A]);(0,i.useEffect)(()=>{D("preset update")},[g,L,z,$,A,D]),(0,i.useEffect)(()=>{Object.entries(l).forEach(([n,e])=>{const[t,o,r]=n.split("_"),a=window.comfyUIAPP?.graph?.getNodeById(t);if(a){const n=a.widgets.find(n=>"value"===n.name);console.log("%c [ window?.ReiToolsUI?.ReiToolsAPI?.widgetValueChange ]-849","font-size:13px; background:pink; color:#bf2c9f;",window?.ReiToolsUI?.ReiToolsAPI?.widgetValueChange),n&&!window?.ReiToolsUI?.ReiToolsAPI?.widgetValueChange&&(n.value=e,n.callback&&n.callback(e,n,a))}}),window.comfyUIAPP?.canvas.setDirty(!0,!0)},[l]);const U=()=>{p(null),f(null)},O=n=>{n.preventDefault(),setTimeout(()=>{U()},50)};return(0,i.useEffect)(()=>{m(!1)},[]),(0,i.useEffect)(()=>{window?.ReiToolsUI?.ReiToolsAPI&&(window.ReiToolsUI.ReiToolsAPI.refreshParamsList=n=>{D(n)})},[L,z,$,A,D]),(0,a.jsxs)(w,{title:"ReiTools 工具面板",visible:n,onClose:e,position:{x:50,y:50},size:{width:350,height:500},className:"reitools-panel",onResize:n=>{m(n.width>=500)},children:[(0,a.jsxs)("div",{className:"reitools-tabs",children:[(0,a.jsx)("button",{className:"tab "+("paramFocus"===t?"active":""),onClick:()=>R("paramFocus"),children:"参数聚焦"}),(0,a.jsx)("button",{className:"tab "+("presets"===t?"active":""),onClick:()=>R("presets"),children:"预设管理(测试)"}),(0,a.jsx)("button",{className:"tab "+("info"===t?"active":""),onClick:()=>R("info"),children:"信息"})]}),(0,a.jsxs)("div",{className:"reitools-content",children:["tools"===t&&(0,a.jsxs)("div",{className:"tools-section",children:[(0,a.jsx)("h3",{children:"快捷工具"}),(0,a.jsxs)("div",{className:"tool-group",children:[(0,a.jsx)("button",{className:"tool-button",children:"📋 复制节点信息"}),(0,a.jsx)("button",{className:"tool-button",children:"🔧 批量修改参数"}),(0,a.jsx)("button",{className:"tool-button",children:"📂 导出配置"}),(0,a.jsx)("button",{className:"tool-button",children:"📥 导入配置"})]}),(0,a.jsx)("h3",{children:"节点操作"}),(0,a.jsxs)("div",{className:"tool-group",children:[(0,a.jsx)("button",{className:"tool-button",children:"➕ 添加常用节点"}),(0,a.jsx)("button",{className:"tool-button",children:"🔗 连接选中节点"}),(0,a.jsx)("button",{className:"tool-button",children:"🗑️ 清理未连接节点"})]})]}),"paramFocus"===t&&(0,a.jsxs)("div",{className:"param-focus-section",children:[(0,a.jsx)("div",{className:"info-section",children:"介绍"}),(0,a.jsxs)("div",{className:"button-group",children:[(0,a.jsxs)("button",{className:"refresh-button",onClick:()=>D("refresh button"),children:[(0,a.jsx)("span",{className:"refresh-icon",children:"🔄"}),"刷新参数列表"]}),(0,a.jsxs)("button",{className:"run-button",onClick:()=>{window.comfyUIAPP?.queuePrompt(0)},children:[(0,a.jsx)("span",{className:"run-icon",children:"▶️"}),"运行"]})]}),(0,a.jsx)("div",{className:"params-list "+(x?"wide-layout":""),children:r.map((n,e)=>(0,a.jsxs)("div",{className:`param-item ${c===e?"dragging":""} ${u===e?"drag-over":""}`,draggable:!0,onDragStart:n=>((n,e)=>{const t=n.target;t.closest("input")||t.closest("textarea")||t.closest("select")?n.preventDefault():(p(e),n.dataTransfer.effectAllowed="move",n.dataTransfer.setData("text/html",""))})(n,e),onDragOver:n=>((n,e)=>{n.preventDefault(),n.stopPropagation(),null!==c&&c!==e&&(n.dataTransfer.dropEffect="move",f(e))})(n,e),onDragLeave:n=>(n=>{n.preventDefault();const e=n.currentTarget.getBoundingClientRect(),t=n.clientX,o=n.clientY;(t<e.left||t>e.right||o<e.top||o>e.bottom)&&f(null)})(n),onDrop:n=>((n,e)=>{if(n.preventDefault(),n.stopPropagation(),null===c||c===e)return void U();const t=[...r],o=t[c];let a=e;c<e&&(a=e-1),t.splice(c,1),t.splice(a,0,o),console.log("Drag operation:",{from:c,to:e,targetIndex:a,itemId:o.id}),s(t),U()})(n,e),onDragEnd:O,children:[(0,a.jsx)("div",{className:"rei-drag-handle",children:"⋮⋮"}),n.title," (",n.name,")","text"===n.type.toLowerCase()&&(0,a.jsx)("input",{type:"text",className:"param-text-input",value:l[`${n.id}_${n.target_id}_${n.target_slot}`]||"",onChange:e=>{d({...l,[`${n.id}_${n.target_id}_${n.target_slot}`]:e.target.value})}}),("string"===n.type.toLowerCase()||"customtext"===n.type.toLowerCase())&&(0,a.jsx)("textarea",{className:"param-input",rows:x?2:3,value:l[`${n.id}_${n.target_id}_${n.target_slot}`]||"",onChange:e=>{d({...l,[`${n.id}_${n.target_id}_${n.target_slot}`]:e.target.value})}}),("int"===n.type.toLowerCase()||"float"===n.type.toLowerCase())&&(0,a.jsx)("input",{type:"number",step:"float"===n.type.toLowerCase()?"0.01":"1",className:"param-number-input",value:l[`${n.id}_${n.target_id}_${n.target_slot}`]||"",onChange:e=>{d({...l,[`${n.id}_${n.target_id}_${n.target_slot}`]:e.target.value})}}),"combo"===n.type.toLowerCase()&&(0,a.jsx)("select",{className:"param-select",value:l[`${n.id}_${n.target_id}_${n.target_slot}`]||"",onChange:e=>{d({...l,[`${n.id}_${n.target_id}_${n.target_slot}`]:e.target.value})},children:n.comboOptions.map(n=>(0,a.jsx)("option",{value:n,children:n},n))})]},`${n.id}_${n.target_id}_${n.target_slot}`))})]}),"config"===t&&(0,a.jsxs)("div",{className:"config-section",children:[(0,a.jsx)("h3",{children:"界面设置"}),(0,a.jsxs)("div",{className:"config-group",children:[(0,a.jsxs)("label",{className:"config-item",children:[(0,a.jsx)("input",{type:"checkbox"}),(0,a.jsx)("span",{children:"启用快捷键"})]}),(0,a.jsxs)("label",{className:"config-item",children:[(0,a.jsx)("input",{type:"checkbox"}),(0,a.jsx)("span",{children:"显示节点预览"})]}),(0,a.jsxs)("label",{className:"config-item",children:[(0,a.jsx)("input",{type:"checkbox"}),(0,a.jsx)("span",{children:"自动保存"})]})]}),(0,a.jsx)("h3",{children:"面板设置"}),(0,a.jsxs)("div",{className:"config-group",children:[(0,a.jsxs)("label",{className:"config-item",children:[(0,a.jsx)("span",{children:"默认位置："}),(0,a.jsxs)("select",{children:[(0,a.jsx)("option",{children:"左上角"}),(0,a.jsx)("option",{children:"右上角"}),(0,a.jsx)("option",{children:"左下角"}),(0,a.jsx)("option",{children:"右下角"})]})]}),(0,a.jsxs)("label",{className:"config-item",children:[(0,a.jsx)("span",{children:"透明度："}),(0,a.jsx)("input",{type:"range",min:"0.5",max:"1",step:"0.1",defaultValue:"1"})]})]})]}),"presets"===t&&(0,a.jsxs)("div",{className:"presets-section",children:[(0,a.jsx)("h3",{children:"预设管理"}),j&&(0,a.jsx)("div",{className:"preset-message "+(j.includes("失败")||j.includes("错误")?"error":"success"),children:j}),(0,a.jsx)("div",{className:"preset-controls",children:(0,a.jsxs)("div",{className:"preset-buttons",children:[(0,a.jsx)("button",{className:"preset-btn primary",onClick:()=>{b(null),y(""),C(""),E(""),N([]),_([]),S(["CheckpointLoaderSimple","UNETLoader"]),P(["LoraLoader"]),T("")},children:"📄 新建预设"}),(0,a.jsx)("button",{className:"preset-btn secondary",onClick:async()=>{T("正在获取预设列表...");try{const n=await fetch("/api/rei/presets/list");if(!n.ok)throw new Error(`HTTP ${n.status}: ${n.statusText}`);const e=(await n.json()).presets||[];if(0===e.length)return void T("暂无可用预设");const t=document.createElement("div");t.className="preset-selector-overlay",t.style.cssText="\n        position: fixed;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        background-color: rgba(0, 0, 0, 0.7);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: 10000;\n      ";const o=document.createElement("div");o.className="preset-selector-modal",o.style.cssText="\n        background: #2b2b2b;\n        border-radius: 8px;\n        width: 80%;\n        max-width: 600px;\n        max-height: 80%;\n        display: flex;\n        flex-direction: column;\n        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);\n        color: #ffffff;\n      ";const r=document.createElement("div");r.style.cssText="\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        padding: 16px 20px;\n        border-bottom: 1px solid #404040;\n        background: #333333;\n        border-radius: 8px 8px 0 0;\n      ";const a=document.createElement("h3");a.textContent="选择预设",a.style.cssText="\n        margin: 0;\n        font-size: 18px;\n        font-weight: 600;\n        color: #4CAF50;\n      ";const i=document.createElement("button");i.textContent="×",i.style.cssText="\n        background: none;\n        border: none;\n        font-size: 24px;\n        color: #ffffff;\n        cursor: pointer;\n        padding: 0;\n        width: 30px;\n        height: 30px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        border-radius: 4px;\n        transition: background-color 0.2s;\n      ",i.addEventListener("click",()=>{document.body.removeChild(t),T("")}),i.addEventListener("mouseover",()=>{i.style.backgroundColor="#555555"}),i.addEventListener("mouseout",()=>{i.style.backgroundColor="transparent"}),r.appendChild(a),r.appendChild(i);const s=document.createElement("div");s.style.cssText="\n        flex: 1;\n        overflow-y: auto;\n        padding: 8px;\n      ",e.forEach(n=>{const e=document.createElement("div");e.style.cssText="\n          display: flex;\n          align-items: center;\n          justify-content: space-between;\n          padding: 16px;\n          margin: 4px 0;\n          background: #333333;\n          border-radius: 6px;\n          cursor: pointer;\n          transition: all 0.2s;\n          border: 2px solid transparent;\n        ",e.addEventListener("mouseenter",()=>{e.style.backgroundColor="#3a3a3a",e.style.borderColor="#4CAF50"}),e.addEventListener("mouseleave",()=>{e.style.backgroundColor="#333333",e.style.borderColor="transparent"});const o=document.createElement("div");o.style.cssText="flex: 1; min-width: 0;";const r=document.createElement("div");r.style.cssText="\n          font-size: 16px;\n          font-weight: 600;\n          color: #ffffff;\n          margin-bottom: 4px;\n        ",r.textContent=n.title||n.name;const a=document.createElement("div");a.style.cssText="\n          font-size: 13px;\n          color: #999999;\n          line-height: 1.4;\n        ";let i=`名称: ${n.name}`;n.description&&(i+=`\n描述: ${n.description}`),i+=`\n更新: ${new Date(n.updated_at).toLocaleString("zh-CN")}`,i+=` • 大小: ${Math.round(n.size/1024)}KB`,a.style.whiteSpace="pre-line",a.textContent=i,o.appendChild(r),o.appendChild(a);const l=document.createElement("div");l.style.cssText="\n          display: flex;\n          gap: 8px;\n          margin-left: 16px;\n        ";const d=document.createElement("button");d.textContent="📤 加载",d.style.cssText="\n          background: #4CAF50;\n          color: white;\n          border: none;\n          padding: 8px 16px;\n          border-radius: 4px;\n          cursor: pointer;\n          font-size: 14px;\n          font-weight: 500;\n          transition: background-color 0.2s;\n        ",d.addEventListener("click",e=>{e.stopPropagation(),document.body.removeChild(t),M(n.name)}),d.addEventListener("mouseover",()=>{d.style.backgroundColor="#45a049"}),d.addEventListener("mouseout",()=>{d.style.backgroundColor="#4CAF50"});const c=document.createElement("button");c.textContent="🗑️",c.style.cssText="\n          background: #f44336;\n          color: white;\n          border: none;\n          padding: 8px 12px;\n          border-radius: 4px;\n          cursor: pointer;\n          font-size: 14px;\n          transition: background-color 0.2s;\n        ",c.addEventListener("click",e=>{e.stopPropagation(),confirm(`确定要删除预设 "${n.title||n.name}" 吗？`)&&(document.body.removeChild(t),(async n=>{if(confirm(`确定要删除预设 "${n}" 吗？此操作无法撤销。`)){T("正在删除...");try{const e=await fetch(`/api/rei/presets/delete/${encodeURIComponent(n)}`,{method:"DELETE"});if(!e.ok){const n=await e.json();throw new Error(n.error||`HTTP ${e.status}`)}T(`预设 "${n}" 删除成功`),g&&g.name===n&&(b(null),y(""),C(""),E(""),N([]),_([]),S(["CheckpointLoaderSimple","UNETLoader"]),P(["LoraLoader"]))}catch(n){T(`删除失败: ${n instanceof Error?n.message:"未知错误"}`)}}})(n.name))}),c.addEventListener("mouseover",()=>{c.style.backgroundColor="#d32f2f"}),c.addEventListener("mouseout",()=>{c.style.backgroundColor="#f44336"}),l.appendChild(d),l.appendChild(c),e.appendChild(o),e.appendChild(l),e.addEventListener("click",()=>{document.body.removeChild(t),M(n.name)}),s.appendChild(e)}),o.appendChild(r),o.appendChild(s),t.appendChild(o),o.addEventListener("click",n=>{n.stopPropagation()}),t.addEventListener("click",()=>{document.body.removeChild(t),T("")}),document.body.appendChild(t),T("")}catch(n){T(`获取预设列表失败: ${n instanceof Error?n.message:"未知错误"}`)}},children:"📤 加载预设"}),(0,a.jsx)("button",{className:"preset-btn secondary",onClick:()=>{y(""),C(""),E(""),N([]),_([]),S(["CheckpointLoaderSimple","UNETLoader"]),P(["LoraLoader"]),T("")},children:"🔄 清空当前"})]})}),(0,a.jsxs)("div",{className:"preset-form",children:[(0,a.jsxs)("div",{className:"form-group",children:[(0,a.jsx)("label",{htmlFor:"preset-name",children:"预设名称:"}),(0,a.jsx)("input",{id:"preset-name",type:"text",value:h,onChange:n=>y(n.target.value),placeholder:"输入预设名称（英文、数字、下划线）",className:"preset-input"})]}),(0,a.jsxs)("div",{className:"form-group",children:[(0,a.jsx)("label",{htmlFor:"preset-title",children:"显示标题:"}),(0,a.jsx)("input",{id:"preset-title",type:"text",value:v,onChange:n=>C(n.target.value),placeholder:"输入显示标题（可选）",className:"preset-input"})]}),(0,a.jsxs)("div",{className:"form-group",children:[(0,a.jsx)("label",{htmlFor:"preset-description",children:"描述:"}),(0,a.jsx)("textarea",{id:"preset-description",value:k,onChange:n=>E(n.target.value),placeholder:"输入预设描述（可选）",className:"preset-textarea",rows:2})]}),(0,a.jsxs)("div",{className:"form-group",children:[(0,a.jsx)("label",{children:"模型加载限制路径:"}),(0,a.jsxs)("div",{className:"path-list",children:[L.map((n,e)=>(0,a.jsxs)("div",{className:"path-item",children:[(0,a.jsx)("span",{className:"path-text",children:n}),(0,a.jsx)("button",{type:"button",className:"path-remove",onClick:()=>N(L.filter((n,t)=>t!==e)),title:"移除路径",children:"🗑️"})]},e)),(0,a.jsx)("button",{type:"button",className:"path-add",onClick:async()=>{try{const n=await F.selectModelDirectory();if(!L.includes(n.path)){if(!n.path.includes("\\")&&!n.path.includes("/"))return void alert("请选择一个特定模型目录下的子文件下，目前模型目录下不在子文件夹下的文件会默认显示，无需添加");N([...L,n.path])}}catch(n){console.log("用户取消了路径选择")}},children:"📁 添加模型路径"})]})]}),(0,a.jsxs)("div",{className:"form-group",children:[(0,a.jsx)("label",{children:"Lora加载限制路径:"}),(0,a.jsxs)("div",{className:"path-list",children:[z.map((n,e)=>(0,a.jsxs)("div",{className:"path-item",children:[(0,a.jsx)("span",{className:"path-text",children:n}),(0,a.jsx)("button",{type:"button",className:"path-remove",onClick:()=>_(z.filter((n,t)=>t!==e)),title:"移除路径",children:"🗑️"})]},e)),(0,a.jsx)("button",{type:"button",className:"path-add",onClick:async()=>{try{const n=await F.selectLoraDirectory();if(!z.includes(n.path)){if(!n.path.includes("\\")&&!n.path.includes("/"))return void alert("请选择一个特定模型目录下的子文件下，目前模型目录下不在子文件夹下的文件会默认显示，无需添加");_([...z,n.path])}}catch(n){console.log("用户取消了路径选择")}},children:"📁 添加Lora路径"})]})]}),(0,a.jsxs)("div",{className:"form-group",children:[(0,a.jsx)("label",{children:"模型加载节点类型:"}),(0,a.jsxs)("div",{className:"node-list",children:[$.map((n,e)=>(0,a.jsxs)("div",{className:"node-item",children:[(0,a.jsx)("span",{className:"node-text",children:n}),(0,a.jsx)("button",{type:"button",className:"node-remove",onClick:()=>S($.filter((n,t)=>t!==e)),title:"移除节点类型",children:"🗑️"})]},e)),(0,a.jsx)("button",{type:"button",className:"node-add",onClick:()=>I($,n=>{$.includes(n)||(S([...$,n]),T(`已添加模型加载节点: ${n}`))},"选择模型加载节点类型"),children:"🎯 添加模型加载节点"})]})]}),(0,a.jsxs)("div",{className:"form-group",children:[(0,a.jsx)("label",{children:"Lora加载节点类型:"}),(0,a.jsxs)("div",{className:"node-list",children:[A.map((n,e)=>(0,a.jsxs)("div",{className:"node-item",children:[(0,a.jsx)("span",{className:"node-text",children:n}),(0,a.jsx)("button",{type:"button",className:"node-remove",onClick:()=>P(A.filter((n,t)=>t!==e)),title:"移除节点类型",children:"🗑️"})]},e)),(0,a.jsx)("button",{type:"button",className:"node-add",onClick:()=>I(A,n=>{A.includes(n)||(P([...A,n]),T(`已添加Lora加载节点: ${n}`))},"选择Lora加载节点类型"),children:"🎨 添加Lora加载节点"})]})]}),(0,a.jsx)("div",{className:"form-actions",children:(0,a.jsx)("button",{className:"preset-btn primary",onClick:async()=>{if(h.trim()){T("正在保存...");try{const n={modelPaths:L,loraPaths:z,modelLoaderNodes:$,loraLoaderNodes:A},e=await fetch("/api/rei/presets/save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:h.trim(),title:v.trim()||h.trim(),description:k.trim(),content:n,version:"1.0",author:"ReiTools User"})});if(!e.ok){const n=await e.json();throw new Error(n.error||`HTTP ${e.status}`)}await e.json(),T(`预设 "${h}" 保存成功`)}catch(n){T(`保存失败: ${n instanceof Error?n.message:"未知错误"}`)}}else T("请输入预设名称")},children:"💾 保存预设"})})]})]}),"info"===t&&(0,a.jsxs)("div",{className:"info-section",children:[(0,a.jsx)("h3",{children:"关于 ReiTools"}),(0,a.jsx)("p",{children:"版本：1.5.1"}),(0,a.jsx)("p",{children:"作者：natsurei"}),(0,a.jsx)("p",{children:"这是一个用于 ComfyUI 的增强工具集，提供了各种便捷的功能和界面改进。"}),(0,a.jsx)("div",{className:"links",children:(0,a.jsx)("a",{href:"https://github.com/x956606865/ComfyUI-ReiTools",target:"_blank",rel:"noopener noreferrer",children:"GitHub 仓库"})})]})]})]})},D=()=>window.app||null,U=()=>!(!window.app||!window.app.graph),O=()=>{const n=D();if(!n||!n.canvas)return[];const e=n.canvas.selected_nodes||{};return Object.values(e)},H=()=>{const n=D();return n&&n.graph&&n.graph._nodes||[]},B=(n,e)=>{const t=D();if(!t||!t.graph||!t.createNode)return null;const o=e||{x:100,y:100};return t.graph.add(t.createNode(n),o.x,o.y)},W=(n,e,t,o)=>{const r=D();if(!r||!r.graph)return!1;try{return r.graph.connect(n.id,e,t.id,o)}catch(n){return console.error("Failed to connect nodes:",n),!1}},V=()=>{const n=D();n&&n.canvas&&(O().forEach(e=>{n.graph.remove(e)}),n.canvas.selectNodes([]))},Y=n=>{const e={type:n.type,position:n.pos,size:n.size,widgets:n.widgets?.map(n=>({name:n.name,value:n.value}))||[],inputs:n.inputs?.map(n=>({name:n.name,type:n.type}))||[],outputs:n.outputs?.map(n=>({name:n.name,type:n.type}))||[]},t=JSON.stringify(e,null,2);navigator.clipboard.writeText(t).catch(console.error)},J=()=>{const n=D();if(!n||!n.graph)return null;try{return n.graph.serialize()}catch(n){return console.error("Failed to export workflow:",n),null}},K=n=>{const e=D();if(!e||!e.graph)return!1;try{return e.graph.clear(),e.graph.configure(n),!0}catch(n){return console.error("Failed to import workflow:",n),!1}},q=()=>{const n=H(),e=[];n.forEach(n=>{const t=n.inputs?.some(n=>n.link)||!1,o=n.outputs?.some(n=>n.links&&n.links.length>0)||!1;t||o||e.push(n)});const t=D();return t&&t.graph&&e.forEach(n=>{t.graph.remove(n)}),e.length},G={PANEL_CONFIG:"reitools_panel_config",USER_PREFERENCES:"reitools_user_preferences",WORKFLOW_TEMPLATES:"reitools_workflow_templates"},X={position:{x:50,y:50},size:{width:350,height:500},visible:!1,activeTab:"tools"},Q={enableShortcuts:!0,showNodePreview:!0,autoSave:!1,defaultPosition:"top-left",opacity:1},Z=(n,e)=>{try{localStorage.setItem(n,JSON.stringify(e))}catch(n){console.error("Failed to save to storage:",n)}},nn=(n,e)=>{try{const t=localStorage.getItem(n);return t?JSON.parse(t):e}catch(n){return console.error("Failed to load from storage:",n),e}},en=n=>{try{localStorage.removeItem(n)}catch(n){console.error("Failed to remove from storage:",n)}},tn=n=>{const e={...on(),...n};Z(G.PANEL_CONFIG,e)},on=()=>nn(G.PANEL_CONFIG,X),rn=n=>{const e={...an(),...n};Z(G.USER_PREFERENCES,e)},an=()=>nn(G.USER_PREFERENCES,Q),sn=(n,e)=>{const t=ln();t[n]={name:n,workflow:e,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()},Z(G.WORKFLOW_TEMPLATES,t)},ln=()=>nn(G.WORKFLOW_TEMPLATES,{}),dn=n=>{const e=ln();delete e[n],Z(G.WORKFLOW_TEMPLATES,e)},cn=()=>{Object.values(G).forEach(n=>{en(n)})};class pn{constructor(){this.panelContainer=null,this.isInitialized=!1,this.panelVisible=!1,this.init()}init(){if(this.isInitialized)return;const n=()=>{U()?(this.setupUI(),this.isInitialized=!0):setTimeout(n,100)};n()}setupUI(){this.panelContainer=document.createElement("div"),this.panelContainer.id="reitools-panel-container",this.panelContainer.style.position="fixed",this.panelContainer.style.top="0",this.panelContainer.style.right="0",this.panelContainer.style.width="100%",this.panelContainer.style.height="100%",this.panelContainer.style.pointerEvents="none",this.panelContainer.style.zIndex="10000",document.body.appendChild(this.panelContainer),this.addToolbarButton();const n=on();this.panelVisible=n.visible,this.renderPanel()}addToolbarButton(){const n=document.createElement("button");n.innerHTML="🔧 ReiTools",n.style.margin="0 5px",n.style.padding="5px 10px",n.style.backgroundColor="#333",n.style.color="#fff",n.style.border="1px solid #555",n.style.borderRadius="4px",n.style.cursor="pointer",n.style.fontSize="12px",n.style.zIndex="10000",n.style.position="fixed",n.style.bottom="20px",n.style.right="70px",n.style.width="90px",n.style.height="40px",n.id="reitools-toolbar-button",n.addEventListener("click",()=>{this.togglePanel()}),n.addEventListener("mouseenter",()=>{n.style.backgroundColor="#555"}),n.addEventListener("mouseleave",()=>{n.style.backgroundColor="#333"}),document.body.appendChild(n)}togglePanel(){this.panelVisible=!this.panelVisible,tn({visible:this.panelVisible}),this.renderPanel()}showPanel(){this.panelVisible=!0,tn({visible:this.panelVisible}),this.renderPanel()}hidePanel(){this.panelVisible=!1,tn({visible:this.panelVisible}),this.renderPanel()}renderPanel(){if(this.panelContainer&&(this.panelContainer.innerHTML="",this.panelVisible)){if(void 0===window.React||void 0===window.ReactDOM){console.warn("React or ReactDOM not available, waiting...");const n=document.createElement("div");return n.style.pointerEvents="auto",n.innerHTML='\n          <div style="\n            position: fixed; \n            top: 100px; \n            right: 100px; \n            background: #2a2a2a; \n            color: white; \n            padding: 20px; \n            border-radius: 8px;\n            border: 1px solid #404040;\n            font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, sans-serif;\n          ">\n            <div>🔧 ReiTools 正在加载...</div>\n            <div style="font-size: 12px; color: #999; margin-top: 8px;">等待 React 依赖加载完成</div>\n          </div>\n        ',this.panelContainer.appendChild(n),void setTimeout(()=>this.renderPanel(),200)}const n=document.createElement("div");n.style.pointerEvents="auto",this.panelContainer.appendChild(n);try{const e=window.React,t=window.ReactDOM,o=e.createElement(I,{visible:this.panelVisible,onClose:()=>this.hidePanel()});t.createRoot?t.createRoot(n).render(o):t.render(o,n),console.log("ReiTools panel rendered successfully")}catch(e){console.error("Failed to render React component:",e),n.innerHTML=`\n          <div style="\n            position: fixed; \n            top: 100px; \n            left: 100px; \n            background: #2a2a2a; \n            color: #ff6b6b; \n            padding: 20px; \n            border-radius: 8px;\n            border: 1px solid #ff6b6b;\n            font-family: monospace;\n            max-width: 400px;\n          ">\n            <h3 style="margin: 0 0 10px 0; color: #ff6b6b;">ReiTools UI 加载错误</h3>\n            <p style="margin: 0 0 10px 0;">React 组件渲染失败，请检查控制台获取详细信息。</p>\n            <details style="margin-top: 10px;">\n              <summary style="cursor: pointer;">错误详情</summary>\n              <pre style="margin: 10px 0 0 0; font-size: 11px; overflow: auto;">${e?.message||"未知错误"}</pre>\n            </details>\n            <button onclick="this.parentElement.style.display='none'" style="\n              background: #333; \n              border: 1px solid #555; \n              color: white; \n              padding: 5px 10px; \n              border-radius: 4px; \n              cursor: pointer;\n              margin-top: 10px;\n            ">关闭</button>\n          </div>\n        `}}}}let un=null;const fn=()=>(un||(un=new pn),un),xn={init:fn,toggle:()=>un?.togglePanel(),show:()=>un?.showPanel(),hide:()=>un?.hidePanel(),selectDirectory:L,selectFile:T,FileSelector:P};return"undefined"!=typeof window&&(window.ReiToolsUI=xn,window.ReiFileSelector=P,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",fn):setTimeout(fn,100)),r})());